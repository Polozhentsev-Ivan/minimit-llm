name: "Build and Test"

on: [pull_request]

jobs:
    build:
        name: Setup&Build
        runs-on: ubuntu-latest
        container:
            image: python:3.12-slim
        steps:
          - name: Checkout
            uses: actions/checkout@v3
            
          - name: Install dependencies
            run: |
                pip install --upgrade uv
                uv venv .venv
                . .venv/bin/activate
                uv pip install -r pyproject.toml
          - name: Prepare pipx for ruff-action
            run: |
                python -m pip install --upgrade pip pipx
                echo "$HOME/.local/bin" >> $GITHUB_PATH            
          - name: Ruff lint check
            uses: astral-sh/ruff-action@v1
            with:
                args: check . --fix
            
          - name: Run tests
            run: |
                uv run pytest -v
